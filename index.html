<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>T√≠nh To√°n B·ªï Sung Dinh D∆∞·ª°ng</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f0f4f8;
    }
    h1 {
      text-align: center;
      color: #2c3e50;
    }
    label {
      display: block;
      margin-top: 10px;
      font-weight: bold;
    }
    input[type="number"] {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      border-radius: 4px;
      border: 1px solid #ccc;
    }
    .checkbox-group {
      display: flex;
      flex-direction: column;
      gap: 5px;
      margin-top: 10px;
    }
    .checkbox-group label {
      font-weight: normal;
    }
    button {
      margin-top: 10px;
      padding: 10px 15px;
      background-color: #3498db;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    button:hover {
      background-color: #2980b9;
    }
    table {
      margin-top: 20px;
      width: 100%;
      border-collapse: collapse;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 10px;
      text-align: center;
    }
    th {
      background-color: #ecf0f1;
    }
    .error {
      color: red;
      font-weight: bold;
      margin-top: 10px;
    }
    .tank-group {
      border: 1px dashed #ccc;
      padding: 10px;
      margin-top: 10px;
      border-radius: 5px;
      background-color: #fff;
    }
    .note {
      margin-top: 20px;
      font-style: italic;
      color: #7f8c8d;
    }
  </style>
</head>
<body>
  <h1>T√≠nh To√°n B·ªï Sung Dinh D∆∞·ª°ng V√†o C√°m</h1>

  <div id="tanks-container">
    <div class="tank-group">
      <label>Kh·ªëi l∆∞·ª£ng c√°m cho b·ªÉ 1 (g):</label>
      <input type="number" class="cam" required>
      <label>Th·ªÉ t√≠ch b·ªÉ 1 (l√≠t):</label>
      <input type="number" class="tank" required>
    </div>
    <div class="tank-group">
      <label>Kh·ªëi l∆∞·ª£ng c√°m cho b·ªÉ 2 (g):</label>
      <input type="number" class="cam" required>
      <label>Th·ªÉ t√≠ch b·ªÉ 2 (l√≠t):</label>
      <input type="number" class="tank" required>
    </div>
  </div>

  <button onclick="addTank()">‚ûï Th√™m b·ªÉ</button>
  <button onclick="removeTank()">‚ûñ X√≥a b·ªÉ cu·ªëi</button>

  <label>Ch·ªçn th√†nh ph·∫ßn b·ªï sung:</label>
  <div class="checkbox-group">
    <label><input type="checkbox" value="tangluc" class="supplement"> TƒÉng l·ª±c (10g/1kg c√°m, 2 l·∫ßn/ng√†y chi·ªÅu)</label>
    <label><input type="checkbox" value="phongduongruot" class="supplement"> Ph√≤ng ƒë∆∞·ªùng ru·ªôt (5g/1kg c√°m, 1 l·∫ßn/ng√†y s√°ng)</label>
    <label><input type="checkbox" value="visinh" class="supplement"> Vi sinh ƒë∆∞·ªùng ru·ªôt (30ml/1kg c√°m/m·ªói l·∫ßn, pha lo√£ng 3 l·∫ßn)</label>
    <label><input type="checkbox" value="tieuhoa" class="supplement"> Ti√™u h√≥a TS (15ml/10kg c√°m/m·ªói l·∫ßn, pha lo√£ng 10 l·∫ßn)</label>
    <label><input type="checkbox" value="bogan" class="supplement"> B·ªï gan (8ml/1kg c√°m/bu·ªïi s√°ng, pha lo√£ng 3 l·∫ßn)</label>
    <label><input type="checkbox" value="visinhnuoc" class="supplement"> Vi sinh ƒë√°nh n∆∞·ªõc (1g/1000L, 3 ng√†y 1 l·∫ßn)</label>
  </div>

  <button onclick="calculate()">T√≠nh to√°n</button>
  <button onclick="downloadResult()">üì• T·∫£i k·∫øt qu·∫£</button>

  <div id="error" class="error"></div>
  <div id="result"></div>
  <div class="note">* ƒê∆°n v·ªã: mg = milligram, ¬µL = microlit</div>

  <script>
    let tankCount = 2;

    function addTank() {
      tankCount++;
      const container = document.getElementById('tanks-container');
      const div = document.createElement('div');
      div.className = 'tank-group';
      div.innerHTML = `
        <label>Kh·ªëi l∆∞·ª£ng c√°m cho b·ªÉ ${tankCount} (g):</label>
        <input type="number" class="cam" required>
        <label>Th·ªÉ t√≠ch b·ªÉ ${tankCount} (l√≠t):</label>
        <input type="number" class="tank" required>
      `;
      container.appendChild(div);
    }

    function removeTank() {
      const container = document.getElementById('tanks-container');
      if (container.children.length > 2) {
        container.removeChild(container.lastElementChild);
        tankCount--;
      }
    }

    function formatMg(value) {
      return `${value.toFixed(2)} mg`;
    }

    function formatUl(value) {
      return `${value.toFixed(2)} ¬µL`;
    }

    function cleanLabel(label) {
      return label.replace(/\s*\(.*?\)/g, "").trim();
    }

    function calculate() {
      const camInputs = document.querySelectorAll('.cam');
      const tankInputs = document.querySelectorAll('.tank');
      const selected = Array.from(document.querySelectorAll('.supplement:checked')).map(cb => cb.value);
      const resultDiv = document.getElementById('result');
      const errorDiv = document.getElementById('error');

      errorDiv.textContent = "";
      resultDiv.innerHTML = "";
      let outputText = "";

      let totalSummary = {
        cam: 0,
        tank: 0,
        tangluc: 0,
        phongduongruot: 0,
        visinh: 0,
        visinhWater: 0,
        tieuhoa: 0,
        tieuhoaWater: 0,
        bogan: 0,
        boganWater: 0,
        visinhnuoc: 0,
        nuoc: 0
      };

      camInputs.forEach((camInput, i) => {
        const camValue = parseFloat(camInput.value) || 0;
        const tankValue = parseFloat(tankInputs[i].value) || 0;
        const camKg = camValue / 1000;
        let waterDeduct = 0;

        const rows = [];
        rows.push(["Kh·ªëi l∆∞·ª£ng c√°m", `${camValue.toFixed(2)} g`]);
        totalSummary.cam += camValue;
        totalSummary.tank += tankValue;

        if (selected.includes("tangluc")) {
          const value = 10 * camKg * 1000;
          rows.push(["TƒÉng l·ª±c", formatMg(value)]);
          totalSummary.tangluc += value;
        }
        if (selected.includes("phongduongruot")) {
          const value = 5 * camKg * 1000;
          rows.push(["Ph√≤ng ƒë∆∞·ªùng ru·ªôt", formatMg(value)]);
          totalSummary.phongduongruot += value;
        }
        if (selected.includes("visinh")) {
          const value = 30 * camKg * 1000 * 3;
          rows.push(["Vi sinh ƒë∆∞·ªùng ru·ªôt", formatUl(value)]);
          waterDeduct += 30 * camKg * 1000 * 2;
          totalSummary.visinh += value;
          totalSummary.visinhWater += 30 * camKg * 1000 * 2;
        }
        if (selected.includes("tieuhoa")) {
          const value = 15 * camKg * 1000 / 10 * 10;
          rows.push(["Ti√™u h√≥a TS", formatUl(value)]);
          waterDeduct += value * (9/10);
          totalSummary.tieuhoa += value;
          totalSummary.tieuhoaWater += value * (9/10);
        }
        if (selected.includes("bogan")) {
          const value = 8 * camKg * 1000 * 3;
          rows.push(["B·ªï gan", formatUl(value)]);
          waterDeduct += 8 * camKg * 1000 * 2;
          totalSummary.bogan += value;
          totalSummary.boganWater += 8 * camKg * 1000 * 2;
        }
        if (selected.includes("visinhnuoc")) {
          const value = tankValue;
          rows.push(["Vi sinh ƒë√°nh n∆∞·ªõc", formatMg(value)]);
          totalSummary.visinhnuoc += value;
        }

        const nuocUl = (camValue * 1000) / 20 - waterDeduct;
        if (nuocUl > 0) {
          rows.push(["B·ªï sung n∆∞·ªõc ƒë√£ tr·ª´ ph·∫ßn pha lo√£ng", formatUl(nuocUl)]);
          totalSummary.nuoc += nuocUl;
        }

        let html = `<h3>K·∫øt qu·∫£ cho b·ªÉ ${i + 1}</h3><table><tr><th>Th√†nh ph·∫ßn</th><th>L∆∞·ª£ng</th></tr>`;
        rows.forEach(row => {
          html += `<tr><td>${cleanLabel(row[0])}</td><td>${row[1]}</td></tr>`;
          outputText += `B·ªÉ ${i + 1} - ${cleanLabel(row[0])}: ${row[1]}\n`;
        });
        html += `</table>`;
        resultDiv.innerHTML += html;
        outputText += `\n`;
      });

      if (tankCount > 1) {
        let html = `<h2>T·ªïng c·ªông t·∫•t c·∫£ b·ªÉ</h2><table><tr><th>Th√†nh ph·∫ßn</th><th>T·ªïng</th></tr>`;
        if (selected.includes("tangluc")) html += `<tr><td>TƒÉng l·ª±c</td><td>${formatMg(totalSummary.tangluc)}</td></tr>`;
        if (selected.includes("phongduongruot")) html += `<tr><td>Ph√≤ng ƒë∆∞·ªùng ru·ªôt</td><td>${formatMg(totalSummary.phongduongruot)}</td></tr>`;
        if (selected.includes("visinh")) html += `<tr><td>Vi sinh ƒë∆∞·ªùng ru·ªôt</td><td>${formatUl(totalSummary.visinh)}</td></tr>`;
        if (selected.includes("tieuhoa")) html += `<tr><td>Ti√™u h√≥a TS</td><td>${formatUl(totalSummary.tieuhoa)}</td></tr>`;
        if (selected.includes("bogan")) html += `<tr><td>B·ªï gan</td><td>${formatUl(totalSummary.bogan)}</td></tr>`;
        if (selected.includes("visinhnuoc")) html += `<tr><td>Vi sinh ƒë√°nh n∆∞·ªõc</td><td>${formatMg(totalSummary.visinhnuoc)}</td></tr>`;
        if (totalSummary.nuoc > 0) html += `<tr><td>B·ªï sung n∆∞·ªõc ƒë√£ tr·ª´ ph·∫ßn pha lo√£ng</td><td>${formatUl(totalSummary.nuoc)}</td></tr>`;
        html += `</table>`;
        resultDiv.innerHTML += html;

        outputText += `T·ªïng c·ªông:\n`;
        outputText += `T·ªïng kh·ªëi l∆∞·ª£ng c√°m: ${totalSummary.cam.toFixed(2)} g\n`;
        if (selected.includes("tangluc")) outputText += `TƒÉng l·ª±c: ${formatMg(totalSummary.tangluc)}\n`;
        if (selected.includes("phongduongruot")) outputText += `Ph√≤ng ƒë∆∞·ªùng ru·ªôt: ${formatMg(totalSummary.phongduongruot)}\n`;
        if (selected.includes("visinh")) outputText += `Vi sinh ƒë∆∞·ªùng ru·ªôt: ${formatUl(totalSummary.visinh)}\n`;
        if (selected.includes("tieuhoa")) outputText += `Ti√™u h√≥a TS: ${formatUl(totalSummary.tieuhoa)}\n`;
        if (selected.includes("bogan")) outputText += `B·ªï gan: ${formatUl(totalSummary.bogan)}\n`;
        if (selected.includes("visinhnuoc")) outputText += `Vi sinh ƒë√°nh n∆∞·ªõc: ${formatMg(totalSummary.visinhnuoc)}\n`;
        if (totalSummary.nuoc > 0) outputText += `B·ªï sung n∆∞·ªõc ƒë√£ tr·ª´ ph·∫ßn pha lo√£ng: ${formatUl(totalSummary.nuoc)}\n`;
      }

      window.generatedResultText = outputText;
    }

    function downloadResult() {
      if (!window.generatedResultText) {
        alert("Vui l√≤ng t√≠nh to√°n tr∆∞·ªõc khi t·∫£i k·∫øt qu·∫£.");
        return;
      }
      const blob = new Blob([window.generatedResultText], { type: "text/plain;charset=utf-8" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "ket_qua_bo_sung_dinh_duong.txt";
      link.click();
    }
  </script>
</body>
</html>
